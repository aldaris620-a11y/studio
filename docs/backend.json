
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the GameSync Hub application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity, matches Firebase Auth UID."
        },
        "username": {
          "type": "string",
          "description": "The user's unique display name (gamertag)."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        },
        "avatar": {
          "type": "string",
          "description": "URL or reference to the user's selected avatar image."
        }
      },
      "required": [
        "id",
        "username",
        "fullName"
      ]
    },
    "Username": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Username",
      "type": "object",
      "description": "Represents a unique username to prevent duplicates.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The UID of the user who owns this username."
        }
      },
      "required": [
        "uid"
      ]
    },
    "GameProgress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameProgress",
      "type": "object",
      "description": "Represents a user's progress in a specific game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GameProgress entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N GameProgress)"
        },
        "gameId": {
          "type": "string",
          "description": "Identifier for the game (e.g., from an external game registry or internal ID)."
        },
        "level": {
          "type": "number",
          "description": "The current level the user has reached in the game."
        },
        "score": {
          "type": "number",
          "description": "The user's current score in the game."
        },
        "lastPlayed": {
          "type": "string",
          "description": "The last time the game was played by the user.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "gameId"
      ]
    },
    "Reward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reward",
      "type": "object",
      "description": "Represents a reward that a user can earn.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Reward entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the reward."
        },
        "description": {
          "type": "string",
          "description": "A description of the reward."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the reward's image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "UserReward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserReward",
      "type": "object",
      "description": "Represents the rewards a user has earned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserReward entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N UserReward)"
        },
        "rewardId": {
          "type": "string",
          "description": "Reference to Reward. (Relationship: Reward 1:N UserReward)"
        },
        "dateEarned": {
          "type": "string",
          "description": "The date the reward was earned.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "rewardId",
        "dateEarned"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Path-based ownership ensures only the authenticated user can access their profile.",
          "subcollections": [
            {
              "path": "game_progress/{gameProgressId}",
              "definition": {
                "entityName": "GameProgress",
                "schema": {
                  "$ref": "#/backend/entities/GameProgress"
                },
                "description": "Stores game progress for a user."
              }
            },
            {
              "path": "user_rewards/{userRewardId}",
              "definition": {
                "entityName": "UserReward",
                "schema": {
                  "$ref": "#/backend/entities/UserReward"
                },
                "description": "Stores rewards earned by a user."
              }
            }
          ]
        }
      },
      {
        "path": "/rewards/{rewardId}",
        "definition": {
          "entityName": "Reward",
          "schema": {
            "$ref": "#/backend/entities/Reward"
          },
          "description": "Stores the definitions of all available rewards in the application. This is considered public or read-only data."
        }
      },
      {
        "path": "/usernames/{username}",
        "definition": {
          "entityName": "Username",
          "schema": {
            "$ref": "#/backend/entities/Username"
          },
          "description": "Stores a mapping of unique usernames to user UIDs to enforce uniqueness. The document ID is the username itself."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to secure user data, game progress, and rewards. Storing user profiles in a root 'users' collection simplifies querying for unique usernames. User-specific data like 'game_progress' and 'user_rewards' are kept in subcollections under each user's document, ensuring data ownership and security through path-based rules. The public 'rewards' collection is accessible to all authenticated users. A separate 'usernames' collection is used to enforce username uniqueness efficiently during registration."
  }
}
