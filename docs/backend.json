{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the GameSync Hub application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
          "type": "string",
          "description": "The user's display name."
        },
        "avatar": {
          "type": "string",
          "description": "URL or reference to the user's selected avatar image."
        }
      },
      "required": [
        "id",
        "username"
      ]
    },
    "GameProgress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameProgress",
      "type": "object",
      "description": "Represents a user's progress in a specific game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GameProgress entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N GameProgress)"
        },
        "gameId": {
          "type": "string",
          "description": "Identifier for the game (e.g., from an external game registry or internal ID)."
        },
        "level": {
          "type": "number",
          "description": "The current level the user has reached in the game."
        },
        "score": {
          "type": "number",
          "description": "The user's current score in the game."
        },
        "lastPlayed": {
          "type": "string",
          "description": "The last time the game was played by the user.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "gameId"
      ]
    },
    "Reward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reward",
      "type": "object",
      "description": "Represents a reward that a user can earn.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Reward entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the reward."
        },
        "description": {
          "type": "string",
          "description": "A description of the reward."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the reward's image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "UserReward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserReward",
      "type": "object",
      "description": "Represents the rewards a user has earned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserReward entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N UserReward)"
        },
        "rewardId": {
          "type": "string",
          "description": "Reference to Reward. (Relationship: Reward 1:N UserReward)"
        },
        "dateEarned": {
          "type": "string",
          "description": "The date the reward was earned.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "rewardId",
        "dateEarned"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Path-based ownership ensures only the authenticated user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Authentication UID."
            },
            {
              "name": "profileId",
              "description": "The unique identifier of the user profile, should be the same as the userId."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/game_progress/{gameProgressId}",
        "definition": {
          "entityName": "GameProgress",
          "schema": {
            "$ref": "#/backend/entities/GameProgress"
          },
          "description": "Stores game progress information for a specific user.  Path-based ownership ensures only the authenticated user can access their game progress.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Authentication UID."
            },
            {
              "name": "gameProgressId",
              "description": "The unique identifier for a specific game progress entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/user_rewards/{userRewardId}",
        "definition": {
          "entityName": "UserReward",
          "schema": {
            "$ref": "#/backend/entities/UserReward"
          },
          "description": "Stores information about rewards earned by a specific user.  Path-based ownership ensures only the authenticated user can access their reward information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Authentication UID."
            },
            {
              "name": "userRewardId",
              "description": "The unique identifier for a specific user reward entry."
            }
          ]
        }
      },
      {
        "path": "/rewards/{rewardId}",
        "definition": {
          "entityName": "Reward",
          "schema": {
            "$ref": "#/backend/entities/Reward"
          },
          "description": "Stores the definitions of all available rewards in the application.  This is considered public or read-only data.",
          "params": [
            {
              "name": "rewardId",
              "description": "The unique identifier for a specific reward."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to secure user data, game progress, and rewards within the GameSync Hub. Prioritizing Authorization Independence, the structure avoids hierarchical `get()` calls in security rules by denormalizing necessary authorization data. This design enhances security, allows atomic operations (transactions/batches), and improves debuggability.\n\n*   **UserProfile (Private Data):**  User profiles are stored under `/users/{userId}/profile`. This path-based ownership ensures that only the authenticated user can access their profile. Since `userId` comes directly from `request.auth.uid`, authorization is simple and secure.\n*   **GameProgress (User-Owned Data):** The `GameProgress` collection is located at `/users/{userId}/game_progress/{gameProgressId}`. This hierarchical path establishes a clear ownership model (User 1:N GameProgress). Security rules can easily enforce that only the authenticated user (`request.auth.uid == userId`) can manage their game progress entries.\n*   **UserRewards (User-Owned Data):** Similar to GameProgress, UserRewards are stored under `/users/{userId}/user_rewards/{userRewardId}` to maintain ownership and simplify rules.\n*   **Rewards (Global Data):** The `rewards` collection at the root level (`/rewards/{rewardId}`) stores the definitions of all available rewards in the application. These rewards can be considered public or read-only data.\n\nQAPs are supported by segregating user-specific data (profiles, game progress, rewards) within user-scoped collections. This ensures that list operations are always scoped to the authenticated user, preventing unauthorized data access. The public `rewards` collection is inherently QAP-compliant as all reward documents share the same access permissions (read access for all authenticated users)."
  }
}